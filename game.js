function BattleRoyalGame(){const e=document.getElementById("myCanvas");class t{constructor(e,t){this.x=e,this.y=t}plus(e){return new t(this.x+e.x,this.y+e.y)}minus(e){return new t(this.x-e.x,this.y-e.y)}divide(e){return new t(this.x/e,this.y/e)}multi(e){return new t(this.x*e,this.y*e)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}lerp(e,t){this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t}norm(){let e=this.mag();return e<1e-8?new t(0,0):new t(this.x/e,this.y/e)}rot(e){let n=Math.atan2(this.y,this.x);return n+=e,new t(Math.cos(n),Math.sin(n))}}let n=new t(0,0),o=[];let l,i,r,a,d,u,s,h=Date.now(),f=50,m=[],c=0,y=0,x=0,p=0,g=0,M=0,b=0,S=0,w=!0,T=0,v=0,L=1,z=0,D=0;function B(e,t,n){for(let l=0;l<o.length;++l){if(l===t)continue;let i=o[l];if(!(i.deadTime>0)){if(l>0&&e.minus(i.pos.plus(i.dir.multi(.5))).mag()<n)return!0;if(e.minus(i.pos).mag()<n)return!0;for(let t=0;t<i.body.length;++t)if(e.minus(i.body[t]).mag()<n)return!0}}return e.x>f-1||e.x<1||e.y>f-1||e.y<1}function k(e){if(0===e)return new t(f/2,f/2);let n=0,l=0,i=o[0].pos.x,r=o[0].pos.y;for(let e=0;e<1e3;++e){let e=3;n=Math.random()*(f-2*e)+e,l=Math.random()*(f-2*e)+e;let t=!0,a=n-i,d=l-r;a*a+d*d<100&&(t=!1);for(let e=0;e<o.length;++e)a=n-o[e].pos.x,d=l-o[e].pos.y,a*a+d*d<25&&(t=!1);if(t)break}return new t(n,l)}function G(e){let t=R(Math.floor(e.x),1,f-2),n=R(Math.floor(e.y),1,f-2),o=null;for(let e=t-1;e<=t+1;++e)for(let t=n-1;t<=n+1;++t){let n=m[t*f+e];for(;null!=n;)n.nextGrab=o,o=n,n=n.next}return o}function A(e){return e.x<c||e.x>=y||e.y<x||e.y>=p}function P(e){return Math.random()*e-.5*e}function E(e){for(let t=0;t<e.body.length;++t){let n=e.body[t];for(let t=0;t<10;++t)Y(n.x+P(.5),n.y+P(.5),e.color)}for(let t=0;t<10;++t)Y(e.pos.x+P(.5),e.pos.y+P(.5),e.color);e.body=[],e.bodyBuilder=[],e.bodyLength=0,e.deadTime=1}function C(e,t,n,o,l){e.fillRect(u.x+(t-s.x-o)*d,u.y+(n-s.y-l)*d,o*d*2,l*d*2)}function F(e){n=new t(2*e.clientX,2*e.clientY)}function I(e,t,n,o,l){e.beginPath(),e.arc(t,n,o,0,2*Math.PI,!1),e.fillStyle=l,e.fill()}function R(e,t,n){return Math.max(t,Math.min(e,n))}function q(){let e=Math.random()*Math.PI*2;return new t(Math.cos(e),Math.sin(e))}function H(e){if(m[e.hash]===e)m[e.hash]=e.next;else{let t=m[e.hash];for(;t.next!==e;)t=t.next;t.next=t.next.next,e.next=null}}function O(e){let t=R(Math.floor(e.pos.x),0,f-1),n=R(Math.floor(e.pos.y),0,f-1);e.hash=n*f+t,e.next=m[e.hash],m[e.hash]=e}e.addEventListener("touchstart",(function(e){F(e.touches[0])}),!1),e.addEventListener("touchmove",(function(e){F(e.touches[0])}),!1),e.addEventListener("touchend",(function(e){F(e.touches[0])}),!1),e.addEventListener("mousemove",(function(e){F(e)}),!1);let W=0,X=0;function Y(e,n,o){X=Math.max(X-1,0);let l=X>0?{}:function(){let e=200;for(;;){let t=Math.floor(Math.random()*f),n=Math.floor(Math.random()*f);if(t<c||t>y||n<x||n>p||--e<0){let e=m[n*f+t];if(null!=e)return H(e),e}}}();l.pos=new t(e,n),l.size=.2*Math.random()+.35,l.sizeScale=1,l.drift=Math.random()*Math.PI*2,l.color=o,l.id=W++,O(l)}let j=[];for(let e=0;e<10;++e)j[e]="hsl("+36*e+", 100%, 50%)";function J(){X=f*f*2,W=0,o=[],m=[],m.length=f*f;let e=Math.floor(Math.random()*j.length),t=e;function n(){let n=t;return t=(t+1)%j.length,t===e&&(t=(t+1)%j.length),n}for(let e=0;e<m.length;++e)m[e]=null;for(let e=0;e<20;++e){let t={};t.pos=k(e),t.dir=q(),t.id=e,t.size=1,t.bodyBuilder=[],t.body=[],t.score=0,t.bodyLength=0,t.deadTime=0,t.lookDistance=.4*Math.random()+1.1,t.color=j[n()],t.turnSpeedDirection=Math.random()<.5?-1:1,t.turnSpeedCurrent=0,t.turnSpeedTarget=0,t.turnSpeedTimer=0,o.push(t)}for(let e=0;e<=f;++e)for(let t=0;t<=f;++t)for(let n=0;n<2;++n)Y(e+Math.random()-.5,t+Math.random()-.5,j[Math.floor(Math.random()*j.length)]);z=1e3+200*L,D=0}J(),window.requestAnimationFrame((function k(){window.requestAnimationFrame(k),function(){let k=Date.now(),P=k-h;h=k,P=Math.min(P/1e3,.035),e.width=2*$(window).width(),e.height=2*$(window).height(),l=e.width,i=e.height,r=Math.min(l,i),a=15,d=r/a,u=new t(.5*l,.5*i);let F=n.minus(u).divide(d),q=[];for(let e=0;e<f*f;++e)q[e]=null;function X(e,t,n){let o=R(Math.floor(e.x),0,f-1),l=R(Math.floor(e.y),0,f-1)*f+o,i={};i.isHead=n,i.pos=e,i.id=t,i.next=q[l],q[l]=i}function Y(e,t){let n=R(Math.floor(e.x),2,f-3),o=R(Math.floor(e.y),2,f-3),l=null;for(let e=n-2;e<=n+2;++e)for(let n=o-2;n<=o+2;++n){let o=q[n*f+e];for(;null!=o;)o.id!==t&&(o.nextGrab=l,l=o),o=o.next}return l}function j(e,t,n){let o=Y(e,t);for(;null!=o;){if(o.isHead){if(t>o.id&&o.pos.minus(e).mag()<n)return!0}else if(o.pos.minus(e).mag()<n)return!0;o=o.nextGrab}return!1}function K(){let e=0,n=0;for(let l=0;l<o.length;++l){let o=3;e=Math.random()*(f-2*o)+o,n=Math.random()*(f-2*o)+o;let l=R(Math.floor(e),5,f-6),i=R(Math.floor(n),5,f-6);for(let o=l-5;o<=l+5;++o)for(let l=i-5;l<=i+5;++l)if(null!=q[l*f+o])return new t(e,n)}return new t(e,n)}if(w){for(let e=0;e<o.length;++e){let t=o[e];if(!(t.deadTime>0)){X(t.pos,t.id,!0);for(let e=0;e<t.body.length;++e)X(t.body[e],t.id,!1)}}for(let e=0;e<o.length;++e){let t=o[e];t.deadTime>0||j(t.pos,e,1)&&E(t)}for(let e=1;e<o.length;++e){let t=o[e];t.deadTime>0&&(t.deadTime-=P,t.deadTime<=0&&e>0&&(t.pos=K()))}F.mag()>.01&&(o[0].dir=F.norm());for(let e=1;e<o.length;++e){let t=o[e];(t.turnSpeedTimer-=P)<0&&(t.turnSpeedTimer=.5*Math.random()+.5,t.turnSpeedDirection=-t.turnSpeedDirection,t.turnSpeedTarget=Math.random()>.3?10*Math.random():0),t.turnSpeedCurrent+=(t.turnSpeedTarget*t.turnSpeedDirection-t.turnSpeedCurrent)*P*2,t.dir=t.dir.rot(t.turnSpeedCurrent*P)}for(let e=1;e<o.length;++e){let t=o[e];if(!(t.deadTime>0)&&B(t.pos.plus(t.dir.multi(1)),e,t.lookDistance))for(let n=1;n<100;++n){if(!B(t.pos.plus(t.dir.rot(-.02*n).multi(1)),e,t.lookDistance)){t.dir=t.dir.rot(-.02*n),t.turnSpeedDirection=-t.turnSpeedDirection;break}if(!B(t.pos.plus(t.dir.rot(.02*n).multi(1)),e,t.lookDistance)){t.dir=t.dir.rot(.02*n),t.turnSpeedDirection=-t.turnSpeedDirection;break}}}for(let e=0;e<o.length;++e){let t=o[e];if(t.deadTime>0)continue;t.pos=t.pos.plus(t.dir.multi(5*P));let n=t.pos.x,l=t.pos.y;(n<0||n>f||l<0||l>f)&&E(t)}for(let e=0;e<o.length;++e){let n=o[e];if(n.deadTime>0)continue;let l=G(n.pos);for(;null!=l;){let e=n.pos.plus(n.dir.multi(.5)),o=e.minus(l.pos),i=o.mag();i<1&&(i=Math.max(0,i-10*P),l.pos=e.minus(o.norm().multi(i)),e.minus(l.pos).mag()<.1&&(n.score++,l.pos=new t(Math.random()*f,Math.random()*f),l.sizeScale=A(l.pos)?1:0,l.id=W++),H(l),O(l)),l=l.nextGrab}}}for(let e=0;e<o.length;++e){let t=o[e];if(t.deadTime>0)continue;if(w){let e=5+t.score/50;t.bodyLength<e&&(t.bodyLength=Math.min(t.bodyLength+2*P,e)),t.bodyLength>e&&(t.bodyLength=Math.max(t.bodyLength-4*P,e))}t.bodyBuilder.push(t.pos),t.body=[];let n=0,l=t.pos,i=.5,r=t.bodyLength;for(n=t.bodyBuilder.length-2;n>=0;--n){let e=t.bodyBuilder[n].minus(l),o=Math.min(Math.min(i,e.mag()),r);if(r-=o,l=l.plus(e.norm().multi(o)),i-=o,r<1e-4){t.body.push(l);break}i<=0&&(++n,i=.5,t.body.push(l))}for(;--n>0;)t.bodyBuilder.shift();r>1e-4&&t.body.push(l)}D=o[0].score;let N=l/r,Q=i/r;s=o[0].pos,c=s.x-.5*a*N-1,y=s.x+.5*a*N+1,x=s.y-.5*a*Q-1,p=s.y+.5*a*Q+1,g=R(Math.floor(c),0,f-1),M=R(Math.ceil(y),0,f-1),b=R(Math.floor(x),0,f-1),S=R(Math.ceil(p),0,f-1);let U=e.getContext("2d");U.fillStyle="#222",U.fillRect(0,0,l,i),U.fillStyle="#333";for(let e=-1;e<=f+1;++e)C(U,e,f/2,.05,f/2+1);for(let e=-1;e<=f+1;++e)C(U,f/2,e,f/2+1,.05);let V=[],Z=function(e,t,n,o){let l=null;for(let i=e;i<=t;++i)for(let e=n;e<=o;++e){let t=m[e*f+i];for(;null!=t;)t.nextGrab=l,l=t,t=t.next}return l}(g,M,b,S);for(;null!=Z;){Z.pos.x=R(Z.pos.x,0,f),Z.pos.y=R(Z.pos.y,0,f),Z.sizeScale<1&&(Z.sizeScale=Math.min(Z.sizeScale+2*P,1)),Z.drift=(Z.drift+5*P)%(2*Math.PI),Z.pos.x+=Math.cos(Z.drift)*P*.3,Z.pos.y+=Math.sin(Z.drift)*P*.3,H(Z),O(Z);let e=0;for(;e<V.length&&V[e].id<Z.id;)e++;V.splice(e,0,Z),Z=Z.nextGrab}for(let e=0;e<V.length;++e){let t=V[e],n=t.pos.minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,(t.size+.3)*t.sizeScale*d/2,"#000")}for(let e=0;e<V.length;++e){let t=V[e],n=t.pos.minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,t.size*t.sizeScale*d/2,t.color)}for(let e=0;e<o.length;++e){let t=o[e];if(t.deadTime>0)continue;for(let e=t.body.length-1;e>=0;--e){let n=t.body[e].minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,(t.size+.2)*d/2,"#000")}let n=t.pos.minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,(t.size+.2)*d/2,"#000")}for(let e=0;e<o.length;++e){let t=o[e];if(t.deadTime>0)continue;for(let e=t.body.length-1;e>=0;--e){let n=t.body[e].minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,t.size*d/2,t.color)}let n=t.pos.minus(s).multi(d);I(U,u.x+n.x,u.y+n.y,t.size*d/2,t.color)}U.fillStyle="#666",C(U,f/2-1e3,0,1e3-f/2-.5,1e3),C(U,1e3+f/2,0,1e3-f/2-.5,1e3),C(U,0,f/2-1e3,1e3,1e3-f/2-.5),C(U,0,1e3+f/2,1e3,1e3-f/2-.5),function(e,t,n,o,l){e.strokeStyle="#ff6666",e.lineWidth=.2*d,e.strokeRect(u.x+(t-s.x-o)*d,u.y+(n-s.y-l)*d,o*d*2,l*d*2)}(U,f/2,f/2,f/2+.5,f/2+.5);let _=7*d,ee=.06*r,te=R(D/z,0,1);function ne(e){U.fillStyle="rgba(0,0,0,"+e+")",U.beginPath(),U.rect(0,0,l,i),U.fill()}function oe(e,t,n){U.fillStyle="rgba(255,255,255,"+n+")",U.font=.1*r+"px Arial",U.textAlign="center",U.textBaseline="middle",U.fillText(e,u.x+t,u.y)}function le(e,t){U.fillStyle="rgba(255,255,255,"+t+")",U.font=.1*r+"px Arial",U.textAlign="center",U.textBaseline="middle",U.fillText("Level "+L,u.x+e,u.y)}function ie(e,t=!1){return T+=e,T>1&&(T=0,v=t?0:v+1,!0)}U.fillStyle="#1d1c",U.beginPath(),U.rect(u.x-_/2,ee,_*te,ee),U.fill(),U.fillStyle="#444c",U.beginPath(),U.rect(u.x+_/2-_*(1-te),ee,_*(1-te),ee),U.fill(),U.fillStyle="#FFF",U.font=.05*r+"px Arial",U.textAlign="center",U.textBaseline="middle",U.fillText(""+L,u.x,.094*r),0===v&&(D>=z&&(w=!1,T=0,v=1),o[0].deadTime>0&&(T=0,v=100));1===v&&(ie(2*P),ne(T));2===v&&(ie(2*P),ne(1),le(0,T));3===v&&(ie(2*P)&&(L++,J()),ne(1),le(100*-T,1-T));4===v&&(ie(2*P),ne(1),le(100*(1-T),T));5===v&&(ie(2*P),ne(1),le(0,1-T));6===v&&(ie(2*P,!0)?w=!0:ne(1-T));100===v&&ie(2*P);101===v&&(ie(2*P)&&(w=!1),ne(T));102===v&&(ie(2*P)&&J(),ne(1),oe("Game Over",0,T));103===v&&(ie(2*P),ne(1),oe("Game Over",100*-T,1-T));104===v&&(ie(2*P),ne(1),oe("Level "+L,100*(1-T),T));105===v&&(ie(2*P),ne(1),oe("Level "+L,0,1-T));106===v&&(ie(2*P,!0)?w=!0:ne(1-T))}()}));const K={passive:!1};function N(e){e.preventDefault()}document.body.addEventListener("touchcancel",N,K),document.body.addEventListener("touchend",N,K)}BattleRoyalGame();